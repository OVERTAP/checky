name: mexc-session-bot-30min

on:
  schedule:
    - cron: "*/30 * * * *"   # 30분 간격(UTC)
  workflow_dispatch:
    inputs:
      first_run:
        description: "최초 실행 포맷(0% | … | HH시)로 보낼래?"
        type: boolean
        required: false
        default: false

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - run: |
          python -m pip install --upgrade pip
          pip install ccxt requests python-dotenv
      - name: Run bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          WATCHLIST_PATH: "watchlist.json"
          TIMEFRAME: "5m"
          TOP_N: "999999"            # watchlist 전부
          TREND_COUNT: "4"           # 딱 4칸
          LINES_PER_MESSAGE: "9999"  # 길이 기준 분할
          DELTA_EMOJI_THRESH: "2.0"  # 🚀/💥 임계
          # 수동 실행에서만 체크값이 들어오고, 스케줄에선 false → 이후 포맷
          FIRST_RUN: ${{ inputs.first_run }}
        run: python tmp.py
