name: mexc-session-bot-30min

on:
  schedule:
    - cron: "*/30 * * * *"   # 30분 간격
  workflow_dispatch:
    inputs:
      first_run:
        description: "최초 실행 포맷(0% | … | HH시)로 보낼래?"
        type: boolean
        required: false
        default: false

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - run: |
          python -m pip install --upgrade pip
          pip install ccxt requests python-dotenv
      - name: Run bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          WATCHLIST_PATH: "watchlist.json"
          TIMEFRAME: "5m"
          TOP_N: "999999"
          TREND_STEP_MIN: "30"
          TREND_COUNT: "4"
          LINES_PER_MESSAGE: "9999"
          DELTA_EMOJI_THRESH: "2.0"
          # 수동 실행 때만 UI의 체크값이 들어오고,
          # 스케줄 실행에선 빈 값이라 코드 기본(false)로 동작해!
          FIRST_RUN: ${{ inputs.first_run }}
        run: python tmp.py
